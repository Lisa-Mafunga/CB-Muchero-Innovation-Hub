var w=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},A=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let l=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{let n=null,a=null,h=null,o=r.status,d=r.statusText;if(r.ok){var u,f;if(s.method!=="HEAD"){var c;const v=await r.text();v===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((c=s.headers.get("Accept"))===null||c===void 0)&&c.includes("application/vnd.pgrst.plan+text"))?a=v:a=JSON.parse(v))}const m=(u=s.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),g=(f=r.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");m&&g&&g.length>1&&(h=parseInt(g[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(a)&&(a.length>1?(n={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,h=null,o=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var p;const m=await r.text();try{n=JSON.parse(m),Array.isArray(n)&&r.status===404&&(a=[],n=null,o=200,d="OK")}catch{r.status===404&&m===""?(o=204,d="No Content"):n={message:m}}if(n&&s.isMaybeSingle&&(!(n==null||(p=n.details)===null||p===void 0)&&p.includes("0 rows"))&&(n=null,o=200,d="OK"),n&&s.shouldThrowOnError)throw new w(n)}return{error:n,data:a,count:h,status:o,statusText:d}});return this.shouldThrowOnError||(l=l.catch(r=>{var n;let a="";const h=r==null?void 0:r.cause;if(h){var o,d,u,f;const p=(o=h==null?void 0:h.message)!==null&&o!==void 0?o:"",m=(d=h==null?void 0:h.code)!==null&&d!==void 0?d:"";a=`${(u=r==null?void 0:r.name)!==null&&u!==void 0?u:"FetchError"}: ${r==null?void 0:r.message}`,a+=`

Caused by: ${(f=h==null?void 0:h.name)!==null&&f!==void 0?f:"Error"}: ${p}`,m&&(a+=` (${m})`),h!=null&&h.stack&&(a+=`
${h.stack}`)}else{var c;a=(c=r==null?void 0:r.stack)!==null&&c!==void 0?c:""}return{error:{message:`${(n=r==null?void 0:r.name)!==null&&n!==void 0?n:"FetchError"}: ${r==null?void 0:r.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),l.then(e,t)}returns(){return this}overrideTypes(){return this}},j=class extends A{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:l=i}={}){const r=l?`${l}.order`:"order",n=this.url.searchParams.get(r);return this.url.searchParams.set(r,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const l=typeof i>"u"?"offset":`${i}.offset`,r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(l,`${e}`),this.url.searchParams.set(r,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:l=!1,format:r="text"}={}){var n;const a=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(n=this.headers.get("Accept"))!==null&&n!==void 0?n:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${r}; for="${h}"; options=${a};`),r==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const y=new RegExp("[,()]");var P=class extends j{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&y.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}notIn(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&y.test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`not.in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let l="";i==="plain"?l="pl":i==="phrase"?l="ph":i==="websearch"&&(l="w");const r=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${l}fts${r}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}},O=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:s=!1,count:i}=t??{},l=s?"HEAD":"GET";let r=!1;const n=(e??"*").split("").map(o=>/\s/.test(o)&&!r?"":(o==='"'&&(r=!r),o)).join(""),{url:a,headers:h}=this.cloneRequestState();return a.searchParams.set("select",n),i&&h.append("Prefer",`count=${i}`),new P({method:l,url:a,headers:h,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var i;const l="POST",{url:r,headers:n}=this.cloneRequestState();if(t&&n.append("Prefer",`count=${t}`),s||n.append("Prefer","missing=default"),Array.isArray(e)){const a=e.reduce((h,o)=>h.concat(Object.keys(o)),[]);if(a.length>0){const h=[...new Set(a)].map(o=>`"${o}"`);r.searchParams.set("columns",h.join(","))}}return new P({method:l,url:r,headers:n,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:l=!0}={}){var r;const n="POST",{url:a,headers:h}=this.cloneRequestState();if(h.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&a.searchParams.set("on_conflict",t),i&&h.append("Prefer",`count=${i}`),l||h.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(o.length>0){const d=[...new Set(o)].map(u=>`"${u}"`);a.searchParams.set("columns",d.join(","))}}return new P({method:n,url:a,headers:h,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}update(e,{count:t}={}){var s;const i="PATCH",{url:l,headers:r}=this.cloneRequestState();return t&&r.append("Prefer",`count=${t}`),new P({method:i,url:l,headers:r,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:e}={}){var t;const s="DELETE",{url:i,headers:l}=this.cloneRequestState();return e&&l.append("Prefer",`count=${e}`),new P({method:s,url:i,headers:l,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},S=class ${constructor(t,{headers:s={},schema:i,fetch:l}={}){this.url=t,this.headers=new Headers(s),this.schemaName=i,this.fetch=l}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new O(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new $(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:i=!1,get:l=!1,count:r}={}){var n;let a;const h=new URL(`${this.url}/rpc/${t}`);let o;const d=c=>c!==null&&typeof c=="object"&&(!Array.isArray(c)||c.some(d)),u=i&&Object.values(s).some(d);u?(a="POST",o=s):i||l?(a=i?"HEAD":"GET",Object.entries(s).filter(([c,p])=>p!==void 0).map(([c,p])=>[c,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([c,p])=>{h.searchParams.append(c,p)})):(a="POST",o=s);const f=new Headers(this.headers);return u?f.set("Prefer",r?`count=${r},return=minimal`:"return=minimal"):r&&f.set("Prefer",`count=${r}`),new P({method:a,url:h,headers:f,schema:this.schemaName,body:o,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}};export{S as P};
